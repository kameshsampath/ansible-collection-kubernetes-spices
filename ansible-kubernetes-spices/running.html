<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ansible Collection Kubernetes Spices :: Ansible Collection Kubernetes Spices</title>
    <link rel="canonical" href="https://kameshsampath.github.com/kubernetes_spices/ansible-kubernetes-spices/running.html">
    <link rel="prev" href="plugins.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://kameshsampath.github.com/kubernetes_spices">Ansible Collection Kubernetes Spices</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ansible-kubernetes-spices" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Ansible Collection Kubernetes Spices</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#prerequisite">Prerequisites</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="roles.html">Roles</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="role-kubernetes-kind.html">KinD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="role-kubernetes-spices.html">Kubernetes Spices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="role-kubernetes-spices.html#deploy-gloo-edge">Gloo Edge</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="role-kubernetes-spices.html#deploy-isito">Istio</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="role-kubernetes-spices.html#deploy-knative">Knative</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="role-kubernetes-spices.html#deploy-keycloak">Keycloak</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="role-kubernetes-spices.html#deploy-olm">Operator Lifecyle Manager(OLM)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="role-kubernetes-spices.html#deploy-postgresql">PostrgeSQL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="role-kubernetes-spices.html#deploy-tektoncd">Tekton</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="plugins.html">Ansible Plugins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="plugins.html#inventory">Inventory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="plugins.html#filters">Filters</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="running.html">Running Playbooks</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Ansible Collection Kubernetes Spices</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Ansible Collection Kubernetes Spices</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Ansible Collection Kubernetes Spices</a></li>
    <li><a href="running.html">Running Playbooks</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/kameshsampath/kubernetes_spices/edit/main/documentation/modules/ROOT/pages/running.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Ansible Collection Kubernetes Spices</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The playbooks could be run using the <a href="https://ansible-builder.readthedocs.io/en/latest/index.html">Ansible Execution</a> environment. The following sections details how to use the Kubernetes Spice Runner environment to run the playbooks to setup your kubernetes stack.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="open-issues"><a class="anchor" href="#open-issues"></a>Open Issues</h2>
<div class="sectionbody">
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><i class="fa fa-square-o"></i> <a href="https://github.com/kameshsampath/kubernetes_spices/issues/14">ISSUE-14</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="runer-gh-template"><a class="anchor" href="#runer-gh-template"></a>Template project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is GitHub template project <a href="https://github.com/kameshsampath/kubernetes-spice-runner" target="_blank" rel="noopener">kubernetes-spice-runner</a> that allows you run the playbooks of this collection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">gh repo create my-k8s-demos -d"my kubernetes spice runner project" -p kameshsampath/kubernetes-spice-runner</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-playbook"><a class="anchor" href="#running-playbook"></a>Running a playbook</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The directory structure follows the <a href="https://ansible-runner.readthedocs.io/en/stable/intro.html#runner-input-directory-hierarchy">Ansible Runner Directory</a> structure.</p>
</div>
<div class="paragraph">
<p>The template playbook already has the roles included</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/kameshsampath/kubernetes-spice-runner/blob/main/project/playbook.yml">playbook.yml</a></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
# This runs only for clusters that are built and run locally
# e.g. KinD
- name: "Local Cloud"
  hosts: kind
  connection: local

  collections:
    - kubernetes.core
    - kameshsampath.kubernetes_spices
  vars:
    ansible_python_interpreter: "{{ ansible_playbook_python }}"
    kind_create: true
    cluster_name: gloo-edge-demo
  roles:
    - name: kameshsampath.kubernetes_spices.kind
# Applies stack to all the cloud
- name: "Spice the Cloud"
  hosts: spices
  connection: local

  collections:
    - kubernetes.core
    - kameshsampath.kubernetes_spices
  vars:
    ansible_python_interpreter: "{{ ansible_playbook_python }}"
    ####
    ## Gloo Edge Configuration
    ####
    # Deploy Gloo Edge
    deploy_gloo_edge: true
    gloo_write_namespace: my-gloo
    # gloo_discovery_enabled: false
    gloo_edge_edition: ee
    gloo_watch_namespaces:
      - hybrid-cloud
      - bookinfo
    gloo_license_key: "{{ ansible_env.GLOO_LICENSE_KEY }}"
  roles:
    - name: kameshsampath.kubernetes_spices.k8s_app_spices</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When new KinD cluster is created, it&#8217;s Kube Contexts is automatically added to the <code>spices</code> group. That allows to apply stacks to local as well as cloud based clusters.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run the playbook:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"><a href="https://github.com/kameshsampath/kubernetes-spice-runner/blob/main/hack.sh">./hack.sh</a></code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically, there will be two files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>kubeconfig</code> file for the cluster</p>
</li>
<li>
<p>The KinD configuration file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <a href="https://github.com/junegunn/fzf">fzf</a> is installed, the script will list the possible playbooks from the <code>$PROJECT_HOME/project</code> directory.</p>
</div>
<div class="paragraph">
<p>Once the cluster is created it also sets and exports the <code>KUBECONFIG</code> to the local <code>$PROJECT_HOME/.kube/config</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="runner-container-image"><a class="anchor" href="#runner-container-image"></a>Container Image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The collection builds ansible execution environment and publishes them at <code>quay.io/kameshsampath/kubernetes-spices-ansible-runner</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="runner-overide-vars"><a class="anchor" href="#runner-overide-vars"></a>Overriding Values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can pass extra variables to playbooks using <code>$PROJECT_HOME/setup/extravars</code>.</p>
</div>
<div class="paragraph">
<p>Make a copy of <code>$PROJECT_HOME/hack/env/extravars.example</code> to <code>$PROJECT_HOME/hack/env/extravars</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp $PROJECT_HOME/hack/env/extravars.example $PROJECT_HOME/hack/env/extravars</code></pre>
</div>
</div>
<div class="paragraph">
<p>Update the extra vars with the parameters corresponding to the stack you want to install. Refer to <a href="roles.html#roles-overview" class="page">roles</a> to find what you can install.</p>
</div>
<div class="paragraph">
<p>The following example shows the <code>extravars</code> that will create a local KinD cluster with a different <code>kind_home_dir</code> set to <code>/home/runner/.kube</code></p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/kameshsampath/kubernetes-spice-runner/blob/main/env/extravars.example">extravars</a></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind_home_dir: /home/runner/.kube</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="plugins.html">Ansible Plugins</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
